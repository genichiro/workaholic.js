{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","workaholic.js","src/channel.es6","src/function-util.es6","src/request.es6","src/workaholic.es6","src/worker-thread.es6"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length",1,"module","_classCallCheck","instance","Constructor","TypeError","_createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","WorkerThread","Request","FunctionUtil","Channel","size","this","requestQueue","workerQueue","push","build","value","request","workerThread","shift","execute","argName","arg","typeTable","string","object","jsonString","JSON","stringify","other","arguments","name","message","fn","fnString","toString","args","Array","slice","pop","fnArgNames","getArgumentNames","_createArgumentInjectionString","_putRequest","promise","./function-util.es6","./request.es6","./worker-thread.es6",2,"exec","str","URL","createObjectURL","Blob","type","source","replace","names","match","split",3,"PromiseState","PENDING","RESOLVED","RequestPromise","state","result","deferred","done","onResolved","functionString",4,"global","Workaholic","self","window","./channel.es6",5,"workerfunc","finish","postMessage","onmessage","eval","data","WORKER_BLOB","toBlob","channel","worker","Worker","_this","resolve","takeRequest"],"mappings":"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","file":"workaholic.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})",null,"module.exports = (function() {\n    let WorkerThread = require('./worker-thread.es6');\n    let Request = require('./request.es6');\n    let FunctionUtil = require('./function-util.es6');\n\n    class Channel {\n        constructor(size) {\n            this.requestQueue = [];\n            this.workerQueue = [];\n\n            // create worker threads\n            for (let i = 0; i < size; i = (i + 1) | 0) {\n                this.workerQueue.push(WorkerThread.build(this));\n            }\n        }\n\n        _putRequest(request) {\n            if (this.workerQueue.length > 0) {\n                let workerThread = this.workerQueue.shift();\n                workerThread.execute(request);\n            } else {\n                this.requestQueue.push(request);\n            }\n        }\n\n        takeRequest(workerThread) {\n            if (this.requestQueue.length > 0) {\n                let request = this.requestQueue.shift();\n                workerThread.execute(request);\n            } else {\n                this.workerQueue.push(workerThread);\n            }\n        }\n\n        _createArgumentInjectionString(argName, arg) {\n            const typeTable = {\n                string: () => {\n                    return `var ${argName}=\\'${arg}\\';`;\n                },\n                object: () => {\n                    let jsonString = JSON.stringify(arg);\n                    return `var ${argName}=${jsonString};`;\n                },\n                other: () => {\n                    return `var ${argName}=${arg};`;\n                }\n            };\n            return (typeTable[typeof arg] || typeTable.other)();\n        }\n\n        execute() {\n            if (arguments.length === 0 || typeof arguments[arguments.length - 1] !== 'function') {\n                throw {\n                    name: 'run \"execute\" error',\n                    message: 'last argument is not \"function\"'\n                };\n            }\n            let fn = arguments[arguments.length - 1];\n            let fnString = FunctionUtil.toString(fn);\n            if (arguments.length >= 2) {\n                // inject arguments into worker\n                var args = Array.prototype.slice.call(arguments);\n                args.pop();\n\n                let fnArgNames = FunctionUtil.getArgumentNames(fn);\n                for (let i = 0; i < args.length && i < fnArgNames.length; i = (i + 1) | 0) {\n                    fnString = this._createArgumentInjectionString(fnArgNames[i], args[i]) + fnString;\n                }\n            }\n            let request = Request.build(fnString);\n            this._putRequest(request);\n            return request.promise;\n        }\n    }\n    return Channel;\n})();\n","module.exports = (function() {\n    class FunctionUtil {\n        static toString(fn) {\n            return /^function\\s*\\w*\\s*\\([\\w\\s,]*\\)\\s*{([\\w\\W]*?)}$/.exec(fn.toString())[1];\n        }\n\n        static toBlob(fn) {\n            let str = FunctionUtil.toString(fn);\n            return URL.createObjectURL(new Blob([str], {type: 'text/javascript'}));\n        }\n\n        static getArgumentNames(fn) {\n            var source = fn.toString().replace(/\\/\\/.*$|\\/\\*[\\s\\S]*?\\*\\/|\\s/gm, ''); // strip comments\n            var names = source.match(/\\((.*?)\\)/)[1].split(',');\n            return (names.length === 1 && names[0] === '') ? [] : names;\n        }\n    }\n    return FunctionUtil;\n})();\n","module.exports = (function() {\n    const PromiseState = {\n        PENDING: 'pending',\n        RESOLVED: 'state'\n    };\n\n    class RequestPromise {\n        constructor() {\n            this.state = PromiseState.PENDING;\n        }\n\n        resolve(result) {\n            this.result = result;\n            this.state = PromiseState.RESOLVED;\n\n            if (this.deferred) {\n                this.done(this.deferred);\n                this.deferred = null;\n            }\n        }\n\n        done(onResolved) {\n            if (this.state === PromiseState.PENDING) {\n                this.deferred = onResolved;\n                return;\n            }\n            onResolved(this.result);\n        }\n\n        static build() {\n            return new RequestPromise();\n        }\n    }\n\n    class Request {\n        constructor(functionString) {\n            this.functionString = functionString;\n            this.promise = RequestPromise.build();\n        }\n\n        static build(fnString) {\n            return new Request(fnString);\n        }\n    }\n    return Request;\n})();\n","(function(global) {\n    let Channel = require('./channel.es6');\n\n    class Workaholic {\n        create(size) {\n            return new Channel(size);\n        }\n    }\n\n    // exports\n    if ('process' in global) {\n        module.exports = Workaholic;\n    }\n    global.Workaholic = new Workaholic();\n})((this || 0).self || global);\n","module.exports = (function() {\n    let FunctionUtil = require('./function-util.es6');\n\n    const workerfunc = () => {\n        /* eslint-disable */\n        let finish = result => {\n            self.postMessage(result);\n        };\n        /* eslint-disable */\n        self.onmessage = e => {\n            eval(e.data);\n        };\n    };\n    const WORKER_BLOB = FunctionUtil.toBlob(workerfunc);\n\n    class WorkerThread {\n        constructor(channel) {\n            this.channel = channel;\n            this.worker = new Worker(WORKER_BLOB);\n        }\n\n        execute(request) {\n            this.request = request;\n            this.worker.postMessage(request.functionString);\n            this.worker.onmessage = e => {\n                if (!this.request) return;\n\n                this.request.promise.resolve(e.data);\n                this.request = null;\n                this.channel.takeRequest(this);\n            };\n        }\n\n        static build(channel) {\n            return new WorkerThread(channel);\n        }\n    }\n    return WorkerThread;\n})();\n"],"sourceRoot":"/source/"}